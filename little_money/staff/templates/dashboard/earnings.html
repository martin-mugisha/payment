{% extends "dashboard/base_staff.html" %} {% block title %}Earnings
Overview{% endblock %} {% block content %}
<h2>Recent Earnings</h2>

<!-- Earnings Summary Table -->
<table class="styled-table">
  <thead>
    <tr>
      <th>Period</th>
      <th>Earnings</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Daily</td>
      <td>
        <ul>
          {% for entry in daily_earnings %}
          <li>{{ entry.day|date:"Y-m-d" }}: {{ entry.total_earnings }}</li>
          {% empty %}
          <li>No data</li>
          {% endfor %}
        </ul>
      </td>
    </tr>
    <tr>
      <td>Weekly</td>
      <td>
        <ul>
          {% for entry in weekly_earnings %}
          <li>{{ entry.week|date:"Y-m-d" }}: {{ entry.total_earnings }}</li>
          {% empty %}
          <li>No data</li>
          {% endfor %}
        </ul>
      </td>
    </tr>
    <tr>
      <td>Monthly</td>
      <td>
        <ul>
          {% for entry in monthly_earnings %}
          <li>{{ entry.month|date:"Y-m" }}: {{ entry.total_earnings }}</li>
          {% empty %}
          <li>No data</li>
          {% endfor %}
        </ul>
      </td>
    </tr>
    <tr>
      <td><strong>Total</strong></td>
      <td><strong>{{ total_staff_earnings }}</strong></td>
    </tr>
  </tbody>
</table>

<!-- Withdrawal History -->
<h3>Withdrawal History</h3>
<table class="styled-table">
  <thead>
    <tr>
      <th>Amount</th>
      <th>Requested On</th>
      <th>Status</th>
    </tr>
  </thead>
  <tbody>
    {% for withdrawal in withdrawals %}
    <tr>
      <td>{{ withdrawal.amount }}</td>
      <td>{{ withdrawal.requested_on|date:"Y-m-d H:i" }}</td>
      <td>{{ withdrawal.status }}</td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="3">No withdrawal history available.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<style>
.export-csv-btn {
  background: #38b2ac;
  color: #fff;
  border: none;
  padding: 8px 18px;
  border-radius: 4px;
  cursor: pointer;
  margin-bottom: 12px;
  font-weight: 600;
  transition: background 0.2s;
}
.export-csv-btn:hover {
  background: #319795;
}
</style>
<button class="export-csv-btn" onclick="exportTableToCSV('earnings.csv')">Export CSV</button>
<script>
function exportTableToCSV(filename) {
    var csv = [];
    var rows = document.querySelectorAll("table.styled-table tr");
    for (var i = 0; i < rows.length; i++) {
        var row = [], cols = rows[i].querySelectorAll("td, th");
        for (var j = 0; j < cols.length; j++)
            row.push('"' + cols[j].innerText.replace(/"/g, '""') + '"');
        csv.push(row.join(","));
    }
    var csvFile = new Blob([csv.join("\n")], { type: "text/csv" });
    var downloadLink = document.createElement("a");
    downloadLink.download = filename;
    downloadLink.href = window.URL.createObjectURL(csvFile);
    downloadLink.style.display = "none";
    document.body.appendChild(downloadLink);
    downloadLink.click();
    document.body.removeChild(downloadLink);
}
</script>
{% endblock %}
