<!-- prettier-ignore -->
{% extends "dashboard/admin/base_admin.html" %} 
{% block title %}
 Transactions 
{% endblock %} 
{% block content %}

<div class="kpi-cards">
  <div class="kpi-card">
    <h3>Total Volume (This Month)</h3>
    <p>UGX{{ total_volume_month }}</p>
  </div>
  <div class="kpi-card">
    <h3>Platform Revenue</h3>
    <p>UGX{{ platform_revenue }}</p>
  </div>
  <div class="kpi-card">
    <h3>Active Merchants</h3>
    <p>{{ active_merchants }}</p>
  </div>
  <div class="kpi-card">
    <h3>Failed Transactions %</h3>
    <p>{{ failed_tx_percent }}%</p>
  </div>
</div>

<form method="get" class="filter-form">
  <label>
    Start Date:
    <input type="date" name="start_date" value="{{ start_date }}" />
  </label>
  <label>
    End Date:
    <input type="date" name="end_date" value="{{ end_date }}" />
  </label>
  <button type="submit" class="btn-primary">Filter</button>
</form>

<table class="data-table">
  <thead>
    <tr>
      <th>ID</th>
      <th>User</th>
      <th>Base Amount</th>
      <th>Platform Fee %</th>
      <th>Platform Fee Amount</th>
      <th>Total</th>
      <th>Status</th>
      <th>Time</th>
    </tr>
  </thead>
  <tbody>
    {% for txn in transactions %}
    <tr>
      <td>{{ txn.transaction_id }}</td>
      <td>{{ txn.user.username }}</td>
      <td>{{ txn.base_amount }}</td>
      <td>{{ txn.platform_fee_percent }}</td>
      <td>{{ txn.platform_fee_amount }}</td>
      <td>{{ txn.total_amount }}</td>
      <td>{{ txn.status }}</td>
      <td>{{ txn.created_at }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<section class="chart-section">
  <h3>Revenue Trend</h3>
  <canvas id="earningsChart" width="100%" height="40"></canvas>
</section>

<script>
  const chartLabels = {{ chart_labels|safe }};
  const chartData = {{ chart_data|safe }};
</script>

{% endblock %}
